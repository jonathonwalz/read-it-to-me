"use strict";function initSynthesis(e,t){var n=[],a=!1;if(e||"undefined"==typeof speechSynthesis||(e=speechSynthesis),e){var r={play:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=new SpeechSynthesisUtterance(t.text);if(r.lang="en-US",r.rate=.8,n.length>0)for(var o=0;o<n.length;o++)if(0===n[o].lang.indexOf("en")&&"Samantha"===n[o].name){r.voice=n[o];break}r.onend=function(){return a(null,t)},r.onerror=function(e){setTimeout(function(){return a(e.error||new Error("Unknown speech synthesis error"),t)},100)},e.speak(r)},pause:function(){e.pause()},resume:function(){e.resume()},cancel:function(){e.cancel()}};0===(n=e.getVoices()).length&&(void 0!==e.onvoiceschanged?e.onvoiceschanged=function(){n=e.getVoices(),t(null,r)}:a=!0),e.cancel(),!n.length&&a?t(new Error("Unable to load voice list")):n.length&&t(null,r)}else t(new Error("Speech Synthesis is unavailable."))}function createControlBar(e,t){var n=e.cancelAudio,a=e.setReadItToMe,r=t.document,o=t.controlBarElement,s=o||r.createElement("div");s.classList.add("read-it-to-me-control-bar"),s.setAttribute("tabindex","0"),s.setAttribute("aria-describedby","ritm-sr-message"),s.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var c=s.querySelector("button"),i=s.querySelector("input.switch-input"),l=function(){s.classList.add("control-bar-show")},u=function(){s.classList.remove("control-bar-show")};if(c.addEventListener("click",n(s)),i.addEventListener("change",function(e){a(e.target.checked,!0)}),s.addEventListener("focusin",function(e){e.target&&s.contains(e.target)&&(s.classList.contains("control-bar-show")||l())}),s.addEventListener("focusout",function(e){(e.relatedTarget&&!s.contains(e.relatedTarget)||!e.relatedTarget)&&u()}),!o){var d=r.body;d.insertBefore(s,d.firstChild)}return{showCancelButton:function(){s.classList.add("show-ritm-cancel")},hideCancelButton:function(){s.classList.remove("show-ritm-cancel")},showControlBar:l,hideControlBar:u,setReadItToMe:function(e){return i.checked=e}}}Object.defineProperty(exports,"__esModule",{value:!0});var synth,PLAYING_STATE={STOPPED:0,PAUSED:1,PLAYING:2};function createRITMGroup(e,t){var n=e.playPauseGroup,a=e.cancelAudio,r=e.focusClassName,o=e.ritmDisabledClassName,s=(e.ritmOptionalTrackingIdentifier,e.elem),c=e.text,i=t.wrapperElement,l=t.controlBubbleElement,u=t.document,d=i||u.createElement("div");if(d.classList.add("read-this-to-me"),!i)for(s.appendChild(d);s.firstChild!==d;)d.appendChild(s.firstChild);var p=l||u.createElement("div");p.classList.add("read-it-to-me-control-bubble"),p.tabIndex=-1,p.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>';var m=p.querySelector("button.play-pause-resume"),f=p.querySelector("button.cancel-audio"),h=function(e){e.stopPropagation(),s.classList.add(r)},v=function(e){e.stopPropagation(),s.classList.remove(r)},g=function(e){e.stopPropagation(),n(y)},b=a(p);p.addEventListener("focusin",h),p.addEventListener("focusout",v),m.addEventListener("click",g),f.addEventListener("click",b),l||s.insertBefore(p,d);var y={setReadItToMe:function(e){e?s.classList.remove(o):s.classList.add(o),m.disabled=!e,f.disabled=!e},setState:function(e){y.state=e,e===PLAYING_STATE.STOPPED?(s.classList.remove("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===PLAYING_STATE.PLAYING?(s.classList.add("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===PLAYING_STATE.PAUSED&&(s.classList.remove("read-it-to-me-play"),s.classList.add("read-it-to-me-pause"))},state:PLAYING_STATE.STOPPED,destroy:function(){p.removeEventListener("focusin",h),p.removeEventListener("focusout",v),m.removeEventListener("click",g),f.removeEventListener("click",b)},text:c};return y}var controlBar,currentGroup,nextGroup,ritmDisabledClassName="ritm-disabled",groupClassName="read-it-to-me-content-group",focusClassName="focusin",contentGroups=[],ritmEnabled=!0,eventsBin={play:null,pause:null,cancel:null,toggle:null},setup=function(){addReadItToMeElements(),sessionStorage.getItem("readItToMeDisabled")&&setReadItToMe(!1)},addReadItToMeElements=function(){document.querySelectorAll(".".concat(groupClassName)).forEach(function(e){var t=e.dataset.ritmOptionalTrackingIdentifier||!1,n=createRITMGroup({playPauseGroup:playPauseGroup,cancelAudio:cancelAudio,focusClassName:focusClassName,ritmDisabledClassName:ritmDisabledClassName,elem:e,ritmOptionalTrackingIdentifier:t,text:function(){return getPlainTextWithPsuedoSemantics(e.querySelector(".read-this-to-me"))}},{document:document});contentGroups.push(n)}),controlBar=createControlBar({cancelAudio:cancelAudio,setReadItToMe:setReadItToMe},{document:document})},clearStrayFocus=function(){var e=document.querySelector(".".concat(focusClassName));e&&e.classList.remove(focusClassName)},setReadItToMe=function(e,t){e?(ritmEnabled=!0,sessionStorage.removeItem("readItToMeDisabled")):(ritmEnabled=!1,clearStrayFocus(),nextGroup=null,synth.cancel(),sessionStorage.setItem("readItToMeDisabled","1")),controlBar.setReadItToMe(ritmEnabled),contentGroups.forEach(function(e){return e.setReadItToMe(ritmEnabled)}),t&&eventsBin.toggle&&eventsBin.toggle(e)},cancelAudio=function(e){return function(){if(eventsBin.cancel)try{eventsBin.cancel()}catch(e){}e.contains(this)&&e.focus(),cancel()}},playPauseGroup=function(e){currentGroup===e?e.state===PLAYING_STATE.STOPPED?(nextGroup=e,utteranceEnd()):e.state===PLAYING_STATE.PAUSED?resume():e.state===PLAYING_STATE.PLAYING&&pause():(nextGroup=e,currentGroup?cancel():utteranceEnd())},getPlainTextWithPsuedoSemantics=function(e){var t=e.cloneNode(!0);return t.querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach(function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))}),t.textContent},utteranceEnd=function(){currentGroup&&(currentGroup.setState(PLAYING_STATE.STOPPED),currentGroup=null,controlBar.hideControlBar(),controlBar.hideCancelButton()),nextGroup&&(currentGroup=nextGroup,nextGroup=null),currentGroup&&play()},play=function(){var e=currentGroup.text();synth.play({text:e},utteranceEnd),controlBar.showCancelButton(),controlBar.showControlBar(),currentGroup.setState(PLAYING_STATE.PLAYING),eventsBin.play&&eventsBin.play()},pause=function(){synth.pause(),currentGroup.setState(PLAYING_STATE.PAUSED),eventsBin.pause&&eventsBin.pause()},resume=function(){synth.resume(),currentGroup.setState(PLAYING_STATE.PLAYING)},cancel=function(){controlBar.hideCancelButton(),synth.cancel()};function init(e){(e&&document.querySelectorAll(e).length>0||document.querySelectorAll(".".concat(groupClassName)).length>0)&&initSynthesis(void 0,function(t,n){!t&&n?(synth=n,e&&document.querySelectorAll(e).length>0&&document.querySelectorAll(e).forEach(function(e){e.classList.add(groupClassName)}),setup()):document.querySelectorAll(".".concat(groupClassName)).forEach(function(e){e.classList.remove(groupClassName,focusClassName)})})}function isEnabled(){return ritmEnabled}function currentUtteranceIdentifier(){return currentGroup&&currentGroup.ritmOptionalTrackingIdentifier||!1}function eventTracking(e){e&&(e.play&&"function"==typeof e.play&&(eventsBin.play=e.play),e.pause&&"function"==typeof e.pause&&(eventsBin.pause=e.pause),e.cancel&&"function"==typeof e.cancel&&(eventsBin.cancel=e.cancel),e.toggle&&"function"==typeof e.toggle&&(eventsBin.toggle=e.toggle))}exports.currentUtteranceIdentifier=currentUtteranceIdentifier,exports.eventTracking=eventTracking,exports.init=init,exports.isEnabled=isEnabled;
//# sourceMappingURL=read-it-to-me.cjs.js.map
