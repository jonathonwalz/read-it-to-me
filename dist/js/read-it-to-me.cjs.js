"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var synth,ui,ritmDisabledClassName="ritm-disabled",groupClassName="read-it-to-me-content-group",focusClassName="focusin",PLAYING_STATE={STOPPED:0,PAUSED:1,PLAYING:2},getPlainTextWithPsuedoSemantics=function(e){var t=e.cloneNode(!0);return t.querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach(function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))}),t.textContent};function initSynthesis(e,t){var n=[],a=!1;if(e||"undefined"==typeof speechSynthesis||(e=speechSynthesis),e){var r=function t(){var n=o.currentUtterance=o.nextUttarance;function a(e){n.callback(e,PLAYING_STATE.STOPPED,n.config),o.nextUttarance?t():o.currentUtterance=null}o.nextUttarance=null,n.u.onend=function(){return setTimeout(a,100)},n.u.onerror=function(e){return setTimeout(a.bind(null,e.error||new Error("Unknown speech synthesis error")),100)},n.u.onstart=function(){return n.callback(null,PLAYING_STATE.PLAYING,n.config)},n.u.onpause=function(){return n.callback(null,PLAYING_STATE.PAUSED,n.config)},n.u.onresume=function(){return n.callback(null,PLAYING_STATE.PLAYING,n.config)},e.speak(n.u)},o={play:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=new SpeechSynthesisUtterance(t.text);if(i.lang="en-US",i.rate=.8,n.length>0)for(var s=0;s<n.length;s++)if(0===n[s].lang.indexOf("en")&&"Samantha"===n[s].name){i.voice=n[s];break}o.nextUttarance={u:i,config:t,callback:a},o.currentUtterance?e.cancel():r()},pause:function(){e.pause()},resume:function(){e.resume()},cancel:function(){e.cancel()}};0===(n=e.getVoices()).length&&(void 0!==e.onvoiceschanged?e.onvoiceschanged=function(){n=e.getVoices(),t(null,o)}:a=!0),e.cancel(),!n.length&&a?t(new Error("Unable to load voice list")):n.length&&t(null,o)}else t(new Error("Speech Synthesis is unavailable."))}function nullEvent(){}function eventHandlerWrapper(e){return function(t){try{e(t)}catch(e){}}}function initEventTracking(){var e={play:nullEvent,pause:nullEvent,cancel:nullEvent,toggle:nullEvent};return{eventsBin:e,setHandlers:function(t){t&&(t.play&&"function"==typeof t.play&&(e.play=eventHandlerWrapper(t.play)),t.pause&&"function"==typeof t.pause&&(e.pause=eventHandlerWrapper(t.pause)),t.cancel&&"function"==typeof t.cancel&&(e.cancel=eventHandlerWrapper(t.cancel)),t.toggle&&"function"==typeof t.toggle&&(e.toggle=eventHandlerWrapper(t.toggle)))}}}var ritmEnabled=!0,_initEventTracking=initEventTracking(),eventsBin=_initEventTracking.eventsBin,setHandlers=_initEventTracking.setHandlers,setup=function(e){ui=e,sessionStorage.getItem("readItToMeDisabled")&&setReadItToMe(!1)},clearStrayFocus=function(){var e=document.querySelector(".".concat(focusClassName));e&&e.classList.remove(focusClassName)},setReadItToMe=function(e,t){e?(ritmEnabled=!0,sessionStorage.removeItem("readItToMeDisabled")):(ritmEnabled=!1,clearStrayFocus(),synth.cancel(),sessionStorage.setItem("readItToMeDisabled","1")),ui.setReadItToMe(ritmEnabled),t&&eventsBin.toggle(e)},cancelAudio=function(e){return function(){eventsBin.cancel(),e.contains(this)&&e.focus(),synth.cancel()}},playPauseGroup=function(e){if(synth.currentUtterance&&synth.currentUtterance.config.group===e&&e.state!==PLAYING_STATE.STOPPED)e.state===PLAYING_STATE.PAUSED?synth.resume():e.state===PLAYING_STATE.PLAYING&&synth.pause();else{var t={text:e.text(),group:e,playTracked:!1};synth.play(t,utteranceUpdated)}},utteranceUpdated=function(e,t,n){n.group.setState(t),t===PLAYING_STATE.STOPPED?(ui.hideControlBar(),ui.hideCancelButton()):(ui.showControlBar(),ui.showCancelButton()),t===PLAYING_STATE.PLAYING?n.playTracked||(eventsBin.play(),n.playTracked=!0):t===PLAYING_STATE.PAUSED&&eventsBin.pause()};function init(e,t){initSynthesis(void 0,function(n,a){if(!n&&a){synth=a;var r=e({playPauseGroup:playPauseGroup,cancelAudio:cancelAudio,setReadItToMe:setReadItToMe});r&&r.hideControlBar&&r.hideCancelButton&&r.showCancelButton&&r.showControlBar&&r.setReadItToMe?setup(r):n=new Error("UI library did not provide necessary callbacks.")}t(n)})}function isEnabled(){return ritmEnabled}function currentUtteranceIdentifier(){return synth.currentUtterance&&synth.currentUtterance.config.group.ritmOptionalTrackingIdentifier||!1}var eventTracking=setHandlers;function createControlBar(e,t){var n=e.cancelAudio,a=e.setReadItToMe,r=t.document,o=t.controlBarElement,i=o||r.createElement("div");i.classList.add("read-it-to-me-control-bar"),i.setAttribute("tabindex","0"),i.setAttribute("aria-describedby","ritm-sr-message"),i.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var s=i.querySelector("button"),c=i.querySelector("input.switch-input"),l=function(){i.classList.add("control-bar-show")},u=function(){i.classList.remove("control-bar-show")};if(s.addEventListener("click",n(i)),c.addEventListener("change",function(e){a(e.target.checked,!0)}),i.addEventListener("focusin",function(e){e.target&&i.contains(e.target)&&(i.classList.contains("control-bar-show")||l())}),i.addEventListener("focusout",function(e){(e.relatedTarget&&!i.contains(e.relatedTarget)||!e.relatedTarget)&&u()}),!o){var d=r.body;d.insertBefore(i,d.firstChild)}return{showCancelButton:function(){i.classList.add("show-ritm-cancel")},hideCancelButton:function(){i.classList.remove("show-ritm-cancel")},showControlBar:l,hideControlBar:u,setReadItToMe:function(e){return c.checked=e}}}function createRITMGroup(e,t){var n=e.playPauseGroup,a=e.cancelAudio,r=e.focusClassName,o=e.ritmDisabledClassName,i=e.ritmOptionalTrackingIdentifier,s=e.elem,c=e.text,l=t.wrapperElement,u=t.controlBubbleElement,d=t.document,p=l||d.createElement("div");if(p.classList.add("read-this-to-me"),!l)for(s.appendChild(p);s.firstChild!==p;)p.appendChild(s.firstChild);var f=u||d.createElement("div");f.classList.add("read-it-to-me-control-bubble"),f.tabIndex=-1,f.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>';var m=f.querySelector("button.play-pause-resume"),h=f.querySelector("button.cancel-audio"),v=function(e){e.stopPropagation(),s.classList.add(r)},g=function(e){e.stopPropagation(),s.classList.remove(r)},T=function(e){e.stopPropagation(),n(y)},b=a(f);f.addEventListener("focusin",v),f.addEventListener("focusout",g),m.addEventListener("click",T),h.addEventListener("click",b),u||s.insertBefore(f,p);var y={setReadItToMe:function(e){e?s.classList.remove(o):s.classList.add(o),m.disabled=!e,h.disabled=!e},setState:function(e){y.state=e,e===PLAYING_STATE.STOPPED?(s.classList.remove("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===PLAYING_STATE.PLAYING?(s.classList.add("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===PLAYING_STATE.PAUSED&&(s.classList.remove("read-it-to-me-play"),s.classList.add("read-it-to-me-pause"))},state:PLAYING_STATE.STOPPED,destroy:function(){f.removeEventListener("focusin",v),f.removeEventListener("focusout",g),m.removeEventListener("click",T),h.removeEventListener("click",b)},text:c,ritmOptionalTrackingIdentifier:i};return y}function init$1(e,t){(t&&document.querySelectorAll(t).length>0||document.querySelectorAll(".".concat(groupClassName)).length>0)&&e(function(e){var n,a=e.playPauseGroup,r=e.cancelAudio,o=e.setReadItToMe;t&&document.querySelectorAll(t).length>0&&document.querySelectorAll(t).forEach(function(e){e.classList.add(groupClassName)});var i=[];return document.querySelectorAll(".".concat(groupClassName)).forEach(function(e){var t=e.dataset.ritmOptionalTrackingIdentifier||!1,n=createRITMGroup({playPauseGroup:a,cancelAudio:r,focusClassName:focusClassName,ritmDisabledClassName:ritmDisabledClassName,elem:e,ritmOptionalTrackingIdentifier:t,text:function(){return getPlainTextWithPsuedoSemantics(e.querySelector(".read-this-to-me"))}},{document:document});i.push(n)}),{hideControlBar:(n=createControlBar({cancelAudio:r,setReadItToMe:o},{document:document})).hideControlBar,hideCancelButton:n.hideCancelButton,showCancelButton:n.showCancelButton,showControlBar:n.showControlBar,setReadItToMe:function(e){n.setReadItToMe(e),i.forEach(function(t){return t.setReadItToMe(e)})}}},function(e){e&&document.querySelectorAll(".".concat(groupClassName)).forEach(function(e){e.classList.remove(groupClassName,focusClassName)})})}var initRITM=init,isEnabled$1=isEnabled,currentUtteranceIdentifier$1=currentUtteranceIdentifier,eventTracking$1=eventTracking;function init$2(e){return init$1(init,e)}exports.currentUtteranceIdentifier=currentUtteranceIdentifier$1,exports.eventTracking=eventTracking$1,exports.init=init$2,exports.initRITM=initRITM,exports.isEnabled=isEnabled$1;
//# sourceMappingURL=read-it-to-me.cjs.js.map
