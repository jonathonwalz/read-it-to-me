var e,t,n="ritm-disabled",a="read-it-to-me-content-group",o="focusin",r={STOPPED:0,PAUSED:1,PLAYING:2},c=function(e){var t=e.cloneNode(!0);return t.querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach(function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))}),t.textContent};function i(){}function s(e){return function(t){try{e(t)}catch(e){}}}var l=!0,u=function(){var e={play:i,pause:i,cancel:i,toggle:i};return{eventsBin:e,setHandlers:function(t){t&&(t.play&&"function"==typeof t.play&&(e.play=s(t.play)),t.pause&&"function"==typeof t.pause&&(e.pause=s(t.pause)),t.cancel&&"function"==typeof t.cancel&&(e.cancel=s(t.cancel)),t.toggle&&"function"==typeof t.toggle&&(e.toggle=s(t.toggle)))}}}(),d=u.eventsBin,f=u.setHandlers,p=function(e){t=e,sessionStorage.getItem("readItToMeDisabled")&&h(!1)},h=function(n,a){var r;n?(l=!0,sessionStorage.removeItem("readItToMeDisabled")):(l=!1,(r=document.querySelector(".".concat(o)))&&r.classList.remove(o),e.cancel(),sessionStorage.setItem("readItToMeDisabled","1")),t.setReadItToMe(l),a&&d.toggle(n)},m=function(t){return function(){d.cancel(),t.contains(this)&&t.focus(),e.cancel()}},g=function(t){if(e.currentUtterance&&e.currentUtterance.config.group===t&&t.state!==r.STOPPED)t.state===r.PAUSED?e.resume():t.state===r.PLAYING&&e.pause();else{var n={text:t.text(),group:t,playTracked:!1};e.play(n,v)}},v=function(e,n,a){a.group.setState(n),n===r.STOPPED?(t.hideControlBar(),t.hideCancelButton()):(t.showControlBar(),t.showCancelButton()),n===r.PLAYING?a.playTracked||(d.play(),a.playTracked=!0):n===r.PAUSED&&d.pause()};function b(t,n){!function(e,t){var n=[],a=!1;if(e||"undefined"==typeof speechSynthesis||(e=speechSynthesis),e){var o=function t(){var n=c.currentUtterance=c.nextUttarance;function a(e){n.callback(e,r.STOPPED,n.config),c.nextUttarance?t():c.currentUtterance=null}c.nextUttarance=null,n.u.onend=function(){return setTimeout(a,100)},n.u.onerror=function(e){return setTimeout(a.bind(null,e.error||new Error("Unknown speech synthesis error")),100)},n.u.onstart=function(){return n.callback(null,r.PLAYING,n.config)},n.u.onpause=function(){return n.callback(null,r.PAUSED,n.config)},n.u.onresume=function(){return n.callback(null,r.PLAYING,n.config)},e.speak(n.u)},c={play:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=new SpeechSynthesisUtterance(t.text);if(r.lang="en-US",r.rate=.8,n.length>0)for(var i=0;i<n.length;i++)if(0===n[i].lang.indexOf("en")&&"Samantha"===n[i].name){r.voice=n[i];break}c.nextUttarance={u:r,config:t,callback:a},c.currentUtterance?e.cancel():o()},pause:function(){e.pause()},resume:function(){e.resume()},cancel:function(){e.cancel()}};0===(n=e.getVoices()).length&&(void 0!==e.onvoiceschanged?e.onvoiceschanged=function(){n=e.getVoices(),t(null,c)}:a=!0),e.cancel(),!n.length&&a?t(new Error("Unable to load voice list")):n.length&&t(null,c)}else t(new Error("Speech Synthesis is unavailable."))}(void 0,function(a,o){if(!a&&o){e=o;var r=t({playPauseGroup:g,cancelAudio:m,setReadItToMe:h});r&&r.hideControlBar&&r.hideCancelButton&&r.showCancelButton&&r.showControlBar&&r.setReadItToMe?p(r):a=new Error("UI library did not provide necessary callbacks.")}n(a)})}function y(e,t){(t&&document.querySelectorAll(t).length>0||document.querySelectorAll(".".concat(a)).length>0)&&e(function(e){var i,s=e.playPauseGroup,l=e.cancelAudio,u=e.setReadItToMe;t&&document.querySelectorAll(t).length>0&&document.querySelectorAll(t).forEach(function(e){e.classList.add(a)});var d=[];return document.querySelectorAll(".".concat(a)).forEach(function(e){var t=e.dataset.ritmOptionalTrackingIdentifier||!1,a=function(e,t){var n=e.playPauseGroup,a=e.cancelAudio,o=e.focusClassName,c=e.ritmDisabledClassName,i=e.ritmOptionalTrackingIdentifier,s=e.elem,l=e.text,u=t.wrapperElement,d=t.controlBubbleElement,f=t.document,p=u||f.createElement("div");if(p.classList.add("read-this-to-me"),!u)for(s.appendChild(p);s.firstChild!==p;)p.appendChild(s.firstChild);var h=d||f.createElement("div");h.classList.add("read-it-to-me-control-bubble"),h.tabIndex=-1,h.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>';var m=h.querySelector("button.play-pause-resume"),g=h.querySelector("button.cancel-audio"),v=function(e){e.stopPropagation(),s.classList.add(o)},b=function(e){e.stopPropagation(),s.classList.remove(o)},y=function(e){e.stopPropagation(),n(L)},T=a(h);h.addEventListener("focusin",v),h.addEventListener("focusout",b),m.addEventListener("click",y),g.addEventListener("click",T),d||s.insertBefore(h,p);var L={setReadItToMe:function(e){e?s.classList.remove(c):s.classList.add(c),m.disabled=!e,g.disabled=!e},setState:function(e){L.state=e,e===r.STOPPED?(s.classList.remove("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===r.PLAYING?(s.classList.add("read-it-to-me-play"),s.classList.remove("read-it-to-me-pause")):e===r.PAUSED&&(s.classList.remove("read-it-to-me-play"),s.classList.add("read-it-to-me-pause"))},state:r.STOPPED,destroy:function(){h.removeEventListener("focusin",v),h.removeEventListener("focusout",b),m.removeEventListener("click",y),g.removeEventListener("click",T)},text:l,ritmOptionalTrackingIdentifier:i};return L}({playPauseGroup:s,cancelAudio:l,focusClassName:o,ritmDisabledClassName:n,elem:e,ritmOptionalTrackingIdentifier:t,text:function(){return c(e.querySelector(".read-this-to-me"))}},{document:document});d.push(a)}),{hideControlBar:(i=function(e,t){var n=e.cancelAudio,a=e.setReadItToMe,o=t.document,r=t.controlBarElement,c=r||o.createElement("div");c.classList.add("read-it-to-me-control-bar"),c.setAttribute("tabindex","0"),c.setAttribute("aria-describedby","ritm-sr-message"),c.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var i=c.querySelector("button"),s=c.querySelector("input.switch-input"),l=function(){c.classList.add("control-bar-show")},u=function(){c.classList.remove("control-bar-show")};if(i.addEventListener("click",n(c)),s.addEventListener("change",function(e){a(e.target.checked,!0)}),c.addEventListener("focusin",function(e){e.target&&c.contains(e.target)&&(c.classList.contains("control-bar-show")||l())}),c.addEventListener("focusout",function(e){(e.relatedTarget&&!c.contains(e.relatedTarget)||!e.relatedTarget)&&u()}),!r){var d=o.body;d.insertBefore(c,d.firstChild)}return{showCancelButton:function(){c.classList.add("show-ritm-cancel")},hideCancelButton:function(){c.classList.remove("show-ritm-cancel")},showControlBar:l,hideControlBar:u,setReadItToMe:function(e){return s.checked=e}}}({cancelAudio:l,setReadItToMe:u},{document:document})).hideControlBar,hideCancelButton:i.hideCancelButton,showCancelButton:i.showCancelButton,showControlBar:i.showControlBar,setReadItToMe:function(e){i.setReadItToMe(e),d.forEach(function(t){return t.setReadItToMe(e)})}}},function(e){e&&document.querySelectorAll(".".concat(a)).forEach(function(e){e.classList.remove(a,o)})})}var T=b,L=function(){return l},C=function(){return e.currentUtterance&&e.currentUtterance.config.group.ritmOptionalTrackingIdentifier||!1},E=f;function S(e){return y(b,e)}export{C as currentUtteranceIdentifier,E as eventTracking,S as init,T as initRITM,L as isEnabled};
//# sourceMappingURL=read-it-to-me.esm.js.map
