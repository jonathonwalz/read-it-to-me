!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ReadItToMe={})}(this,function(e){"use strict";var t,n={STOPPED:0,PAUSED:1,PLAYING:2};function a(){}function o(e){return function(t){try{e(t)}catch(e){}}}var s,i,r,c="read-it-to-me-content-group",l="focusin",u=[],d=!0,f=function(){var e={play:a,pause:a,cancel:a,toggle:a};return{eventsBin:e,setHandlers:function(t){t&&(t.play&&"function"==typeof t.play&&(e.play=o(t.play)),t.pause&&"function"==typeof t.pause&&(e.pause=o(t.pause)),t.cancel&&"function"==typeof t.cancel&&(e.cancel=o(t.cancel)),t.toggle&&"function"==typeof t.toggle&&(e.toggle=o(t.toggle)))}}}(),p=f.eventsBin,m=f.setHandlers,h=function(){v(),sessionStorage.getItem("readItToMeDisabled")&&g(!1)},v=function(){document.querySelectorAll(".".concat(c)).forEach(function(e){var t=e.dataset.ritmOptionalTrackingIdentifier||!1,a=function(e,t){var a=e.playPauseGroup,o=e.cancelAudio,s=e.focusClassName,i=e.ritmDisabledClassName,r=(e.ritmOptionalTrackingIdentifier,e.elem),c=e.text,l=t.wrapperElement,u=t.controlBubbleElement,d=t.document,f=l||d.createElement("div");if(f.classList.add("read-this-to-me"),!l)for(r.appendChild(f);r.firstChild!==f;)f.appendChild(r.firstChild);var p=u||d.createElement("div");p.classList.add("read-it-to-me-control-bubble"),p.tabIndex=-1,p.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>';var m=p.querySelector("button.play-pause-resume"),h=p.querySelector("button.cancel-audio"),v=function(e){e.stopPropagation(),r.classList.add(s)},g=function(e){e.stopPropagation(),r.classList.remove(s)},b=function(e){e.stopPropagation(),a(L)},y=o(p);p.addEventListener("focusin",v),p.addEventListener("focusout",g),m.addEventListener("click",b),h.addEventListener("click",y),u||r.insertBefore(p,f);var L={setReadItToMe:function(e){e?r.classList.remove(i):r.classList.add(i),m.disabled=!e,h.disabled=!e},setState:function(e){L.state=e,e===n.STOPPED?(r.classList.remove("read-it-to-me-play"),r.classList.remove("read-it-to-me-pause")):e===n.PLAYING?(r.classList.add("read-it-to-me-play"),r.classList.remove("read-it-to-me-pause")):e===n.PAUSED&&(r.classList.remove("read-it-to-me-play"),r.classList.add("read-it-to-me-pause"))},state:n.STOPPED,destroy:function(){p.removeEventListener("focusin",v),p.removeEventListener("focusout",g),m.removeEventListener("click",b),h.removeEventListener("click",y)},text:c};return L}({playPauseGroup:y,cancelAudio:b,focusClassName:l,ritmDisabledClassName:"ritm-disabled",elem:e,ritmOptionalTrackingIdentifier:t,text:function(){return L(e.querySelector(".read-this-to-me"))}},{document:document});u.push(a)}),s=function(e,t){var n=e.cancelAudio,a=e.setReadItToMe,o=t.document,s=t.controlBarElement,i=s||o.createElement("div");i.classList.add("read-it-to-me-control-bar"),i.setAttribute("tabindex","0"),i.setAttribute("aria-describedby","ritm-sr-message"),i.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var r=i.querySelector("button"),c=i.querySelector("input.switch-input"),l=function(){i.classList.add("control-bar-show")},u=function(){i.classList.remove("control-bar-show")};if(r.addEventListener("click",n(i)),c.addEventListener("change",function(e){a(e.target.checked,!0)}),i.addEventListener("focusin",function(e){e.target&&i.contains(e.target)&&(i.classList.contains("control-bar-show")||l())}),i.addEventListener("focusout",function(e){(e.relatedTarget&&!i.contains(e.relatedTarget)||!e.relatedTarget)&&u()}),!s){var d=o.body;d.insertBefore(i,d.firstChild)}return{showCancelButton:function(){i.classList.add("show-ritm-cancel")},hideCancelButton:function(){i.classList.remove("show-ritm-cancel")},showControlBar:l,hideControlBar:u,setReadItToMe:function(e){return c.checked=e}}}({cancelAudio:b,setReadItToMe:g},{document:document})},g=function(e,n){var a;e?(d=!0,sessionStorage.removeItem("readItToMeDisabled")):(d=!1,(a=document.querySelector(".".concat(l)))&&a.classList.remove(l),r=null,t.cancel(),sessionStorage.setItem("readItToMeDisabled","1")),s.setReadItToMe(d),u.forEach(function(e){return e.setReadItToMe(d)}),n&&p.toggle(e)},b=function(e){return function(){p.cancel(),e.contains(this)&&e.focus(),w()}},y=function(e){i===e?e.state===n.STOPPED?(r=e,S()):e.state===n.PAUSED?C():e.state===n.PLAYING&&T():(r=e,i?w():S())},L=function(e){var t=e.cloneNode(!0);return t.querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach(function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))}),t.textContent},S=function(){i&&(i.setState(n.STOPPED),i=null,s.hideControlBar(),s.hideCancelButton()),r&&(i=r,r=null),i&&E()},E=function(){var e=i.text();t.play({text:e},S),s.showCancelButton(),s.showControlBar(),i.setState(n.PLAYING),p.play()},T=function(){t.pause(),i.setState(n.PAUSED),p.pause()},C=function(){t.resume(),i.setState(n.PLAYING)},w=function(){s.hideCancelButton(),t.cancel()};var P=m;e.currentUtteranceIdentifier=function(){return i&&i.ritmOptionalTrackingIdentifier||!1},e.eventTracking=P,e.init=function(e){(e&&document.querySelectorAll(e).length>0||document.querySelectorAll(".".concat(c)).length>0)&&function(e,t){var n=[],a=!1;if(e||"undefined"==typeof speechSynthesis||(e=speechSynthesis),e){var o={play:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},o=new SpeechSynthesisUtterance(t.text);if(o.lang="en-US",o.rate=.8,n.length>0)for(var s=0;s<n.length;s++)if(0===n[s].lang.indexOf("en")&&"Samantha"===n[s].name){o.voice=n[s];break}o.onend=function(){return a(null,t)},o.onerror=function(e){setTimeout(function(){return a(e.error||new Error("Unknown speech synthesis error"),t)},100)},e.speak(o)},pause:function(){e.pause()},resume:function(){e.resume()},cancel:function(){e.cancel()}};0===(n=e.getVoices()).length&&(void 0!==e.onvoiceschanged?e.onvoiceschanged=function(){n=e.getVoices(),t(null,o)}:a=!0),e.cancel(),!n.length&&a?t(new Error("Unable to load voice list")):n.length&&t(null,o)}else t(new Error("Speech Synthesis is unavailable."))}(void 0,function(n,a){!n&&a?(t=a,e&&document.querySelectorAll(e).length>0&&document.querySelectorAll(e).forEach(function(e){e.classList.add(c)}),h()):document.querySelectorAll(".".concat(c)).forEach(function(e){e.classList.remove(c,l)})})},e.isEnabled=function(){return d},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=read-it-to-me.min.js.map
