!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ReadItToMe={})}(this,function(e){"use strict";var t,n,a,o,c=window.speechSynthesis,i="read-it-to-me-content-group",s="focusin",r=[],l=[],d=!0,u={play:null,pause:null,cancel:null,toggle:null},f=function(){0===(l=c.getVoices()).length&&void 0!==c.onvoiceschanged&&(c.onvoiceschanged=function(){l=c.getVoices()}),m(),x(),sessionStorage.getItem("readItToMeDisabled")&&(n.querySelector("input.switch-input").checked=!1,w())},p=function(e){e.hasAttribute("tabindex")?e.classList.contains("ritm-do-not-strip-tabindex")||e.classList.add("ritm-do-not-strip-tabindex"):e.setAttribute("tabindex","0")},m=function(){var e=document.querySelectorAll(".".concat(i)),a=document.createElement("div");a.classList.add("read-this-to-me"),e.forEach(function(e){var t=a.cloneNode(!1);for(e.appendChild(t);e.firstChild!==t;)t.appendChild(e.firstChild)}),(t=document.createElement("div")).classList.add("read-it-to-me-control-bubble"),t.innerHTML='<p class="read-it-to-me-label"></p><button type="button" class="play-pause-resume"></button><button type="button" class="cancel-audio"><span class="visually-hidden">Cancel audio</a></button>',(n=document.createElement("div")).classList.add("read-it-to-me-control-bar"),n.setAttribute("tabindex","0"),n.setAttribute("aria-describedby","ritm-sr-message"),n.innerHTML='<div class="toggle-wrapper">\n                            <p class="visually-hidden" id="ritm-sr-message">Screen-reader users: there is a rudimentary "on-demand" read-aloud feature in use on this page called "Read-it-to-Me".  This new feature, which isn\'t meant as a screen-reader alternative, adds more tabable areas in the document which are great for keyboard users not using screen-readers, but are likely to be annoying for you. You can toggle off/on "Read-it-to-Me" using this checkbox.</p>\n                            <p class="read-it-to-me-label">Toggle Read-it-to-Me</p>\n                            <label class="switch" aria-label="Toggle Read-it-to-Me." aria-describedby="ritm-sr-message">\n                              <input type="checkbox" class="switch-input" checked>\n                              <span class="switch-outline"></span>\n                              <span class="switch-label" data-on="On" data-off="Off"></span>\n                              <span class="switch-handle"></span>\n                            </label>\n                          </div>\n                          <div class="cancel-audio-wrapper">\n                            <button type="button" class="btn btn-default btn-lg">Cancel audio</button>\n                          </div>';var o=document.body;o.insertBefore(n,o.firstChild),o.appendChild(t)},h=function(e){if(t.parentNode!==e)try{e.insertBefore(t,e.firstChild)}catch(e){}},b=function(){try{document.body.appendChild(t)}catch(e){}},g=function(){var e=document.querySelector(".".concat(s));e&&e.classList.remove(s)},y=function(e){if(!d)return!1;g();var t=e.target;t&&t.matches(".".concat(i))&&!t.querySelector(".read-it-to-me-control-bubble")&&h(t)},v=function(e){if(!d)return!1;var t=e.relatedTarget?e.relatedTarget.closest(".".concat(i)):null;t?h(t):b()},L=function(e){if(!d)return!1;e.stopPropagation();var t,n=e.target,a=e.relatedTarget;if(n&&n.matches(".".concat(i))&&(t=!(!a||n.firstChild.querySelector("button")!==a),n.classList.contains(s)||n.classList.add(s),n.querySelector(".read-it-to-me-control-bubble")||h(n),!t)){var o=window.scrollY;n.firstChild.querySelector("button").focus(),window.scroll(0,o)}},S=function(e){if(!d)return!1;e.stopPropagation();var t=e.target,n=e.relatedTarget;if(t&&n){if(t.matches(".".concat(i))&&n.matches(".read-it-to-me-control-bubble button")&&t.contains(n))return!1;if(t.matches(".read-it-to-me-control-bubble button")&&n.matches(".".concat(i))&&n.contains(t))return!1;if(t.matches(".read-it-to-me-control-bubble button")&&n.matches(".read-it-to-me-control-bubble button"))return!1;(t.matches(".".concat(i))?t:t.closest(".".concat(i))).classList.remove(s),b()}},w=function(e){var t=e?e.target:n.querySelector("input.switch-input"),a=document.querySelectorAll(".".concat(i));t.checked?(d=!0,sessionStorage.removeItem("readItToMeDisabled"),a.forEach(function(e){e.classList.remove("ritm-disabled"),p(e)})):(d=!1,g(),c.cancel(),sessionStorage.setItem("readItToMeDisabled","1"),a.forEach(function(e){e.classList.add("ritm-disabled"),e.classList.contains("ritm-do-not-strip-tabindex")||e.removeAttribute("tabindex")})),e&&u.toggle&&u.toggle()},T=function(e){e.target&&n.contains(e.target)&&(n.classList.contains("control-bar-show")||A())},E=function(e){(e.relatedTarget&&!n.contains(e.relatedTarget)||!e.relatedTarget)&&I()},q=function(){if(u.cancel)try{u.cancel()}catch(e){}n.contains(void 0)&&n.focus(),t.contains(void 0)&&t.focus(),R()},x=function(){t.querySelector("button.play-pause-resume").addEventListener("click",function(e){if(!d)return!1;e.stopPropagation();var t=e.target.closest(".".concat(i));C(t)}),t.querySelector("button.cancel-audio").addEventListener("click",q),n.querySelector("button").addEventListener("click",q),n.querySelector("input.switch-input").addEventListener("change",w),n.addEventListener("focusin",T),n.addEventListener("focusout",E),document.querySelectorAll(".".concat(i)).forEach(function(e){e.addEventListener("mouseenter",y),e.addEventListener("click",y),e.addEventListener("mouseleave",v),e.addEventListener("focusin",L),e.addEventListener("focusout",S)}),c.cancel()},C=function(e){e.classList.contains("read-it-to-me-play")||e.classList.contains("read-it-to-me-pause")?e.classList.contains("read-it-to-me-play")?(H(),e.classList.toggle("read-it-to-me-play"),e.classList.toggle("read-it-to-me-pause")):e.classList.contains("read-it-to-me-pause")&&(O(),e.classList.toggle("read-it-to-me-play"),e.classList.toggle("read-it-to-me-pause")):(r.push(e),document.querySelectorAll(".read-it-to-me-play").length>0||document.querySelectorAll(".read-it-to-me-pause").length>0?R():N(),e.classList.toggle("read-it-to-me-play"))},k=function(){n.classList.remove("show-ritm-cancel")},A=function(){n.classList.add("control-bar-show")},I=function(){n.classList.remove("control-bar-show")},M=function(){var e;r.length>0&&((e=r[0]).classList.remove("read-it-to-me-play"),e.classList.remove("read-it-to-me-pause"),I(),k(),r.shift()),r.length>0&&N(),o=null},N=function(){var e,t,i=(e=r[0].querySelector(".read-this-to-me"),(t=e.cloneNode(!0)).querySelectorAll("p, li, abbr, strong, em, h1, h2, h3, h4, h5, h6").forEach(function(e){var t=e.tagName.toUpperCase();if("P"===t)e.appendChild(document.createTextNode(". "));else if("ABBR"===t){var n=e.textContent.split("");e.textContent=n.join(".")}else"STRONG"===t||"EM"===t?(e.insertBefore(document.createTextNode(", "),e.firstChild),e.appendChild(document.createTextNode(", "))):"LI"===t?e.appendChild(document.createTextNode(", ")):"H1"!==t&&"H2"!==t&&"H3"!==t&&"H4"!==t&&"H5"!==t&&"H6"!==t||e.appendChild(document.createTextNode(", "))}),t.textContent);if((a=new SpeechSynthesisUtterance(i)).lang="en-US",a.rate=.8,l.length>0)for(var s=0;s<l.length;s++)if(0===l[s].lang.indexOf("en")&&"Samantha"===l[s].name){a.voice=l[s];break}a.onend=M,a.onerror=function(){o||(o=window.setTimeout(M,100))},c.speak(a),n.classList.add("show-ritm-cancel"),A(),u.play&&u.play()},H=function(){c.pause(),u.pause&&u.pause()},O=function(){c.resume()},R=function(){k(),c.cancel()};e.currentUtteranceIdentifier=function(){return!(!r[0]||!r[0].dataset.ritmOptionalTrackingIdentifier||""===r[0].dataset.ritmOptionalTrackingIdentifier)&&r[0].dataset.ritmOptionalTrackingIdentifier},e.eventTracking=function(e){e&&(e.play&&"function"==typeof e.play&&(u.play=e.play),e.pause&&"function"==typeof e.pause&&(u.pause=e.pause),e.cancel&&"function"==typeof e.cancel&&(u.cancel=e.cancel),e.toggle&&"function"==typeof e.toggle&&(u.toggle=e.toggle))},e.init=function(e){c?(e&&document.querySelectorAll(e).length>0&&document.querySelectorAll(e).forEach(function(e){e.classList.add(i)}),document.querySelectorAll(".".concat(i)).forEach(function(e){p(e)}),document.querySelectorAll(".".concat(i))&&f()):document.querySelectorAll(".".concat(i)).forEach(function(e){e.classList.remove(i,s)})},e.isEnabled=function(){return d},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=read-it-to-me.min.js.map
